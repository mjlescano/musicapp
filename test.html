<html>
<head>
	<title>MusicApp</title>
	<link rel="stylesheet" type="text/css" href="css/styles.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.3.3/underscore-min.js"></script>
	<script src="js/musicapp.js"></script>
	<script type="text/javascript">
		_.templateSettings = {
			interpolate : /\{\{(.+?)\}\}/g
		};
		$(function() {
			var $t = $('#templates');
			var $play = $('#playing');
			var templates = {
				youtube: $t.find('#youtube').html()
			};

			function parseYoutube(r) {
				var songs = [], type = 'youtube';
				_.each(r.feed.entry, function(e) {
					var d = {
						type: type,
						id: e['media$group']['yt$videoid']['$t'],
						title: e.title['$t']
					};
					songs.push(d);
				});
				return songs;
			}

			function search(query) {
				var url = 'api/youtube.php?q=' + encodeURIComponent(query);
				$.ajax({
					url: url,
					success: function(r) {
						var song = parseYoutube(r)[0];
						console.log('youtube: ', song);
						$play.html( _.template(templates[song.type], song) );
					},
					complete: function (response, msg) {
						console.log('search:' + msg);
					}
				});
			};

			play = search;
		});
	</script>
</head>
<body>
	<div id="templates" style="display:none">
		<div id="youtube">
			<object width="100%" height="100%">
			<param name="movie"
				value="https://www.youtube.com/v/{{id}}?version=3&autoplay=1">
			</param>
			<param name="allowScriptAccess" value="always"></param>
			<embed src="https://www.youtube.com/v/{{id}}?version=3&autoplay=1"
				type="application/x-shockwave-flash"
				allowscriptaccess="always"
				width="100%" height="100%">
			</embed>
			</object>
		</div>
	</div>
	<div id="playing"></div>
</body>
</html>